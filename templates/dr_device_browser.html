{% extends "base_layout.html" %}
{% block li_dr_registry %}class="active"{% endblock %}
{% block body %}
</h1>
<h3>Device registry explorer </h3>
<div class="container-fluid">

<table class="table table-bordered table-striped table-hover">
   <thead>
      <tr>
        <th><h6>Id</h6></th>
        <th><h6>Integr. Id</h6></th>
        <th><h6>Address</h6></th>
        <th><h6>Serial Number</h6></th>
        <th><h6>Name</h6></th>
        <th><h6>Alias</h6></th>
        <th><h6>Services</h6></th>
        <th><h6>Comm Tech</h6></th>
        <th><h6>Manufacturer</h6></th>
        <th><h6>Hw Ver.</h6></th>
        <th><h6>Sw Ver.</h6></th>
        <th><h6>Protocol Ver</h6></th>
        <th><h6>Product Id</h6></th>
        <th><h6>Product Type Id</h6></th>
        <th><h6>Hash code</h6></th>
        <th><h6>Status</h6></th>
        <th><h6>Last Error Msg</h6></th>
        <th style="min-width: 80px"><h6>First Use Date</h6></th>
        <th style="min-width: 80px"><h6>Last Update</h6></th>
        <th><h6>Security Level</h6></th>
        <th><h6>Properties</h6></th>
        <th><h6>Action</h6></th>
      </tr>
   </thead>
   <tbody>
   {% if dr_response.event.properties.device_list.value %}
   {%  for device in dr_response.event.properties.device_list.value %}
       <tr>
        <td rowspan="2" >{{ device.Id }}</td>
        <td>{{ device.IntegrationId }}</td>
        <td>{{ device.Address }}</td>
        <td>{{ device.SerialNumber }}</td>
        <td>{{ device.Name }}</td>
        <td>{{ device.Alias }}</td>
        <td><a data-toggle="collapse" href="#endpoints_{{ device.Id }}">Services</a></td>
        <td>{{ device.CommunicationTechnology }}</td>
        <td>{{ device.Manufacturer }}</td>
        <td>{{ device.HardwareVersion }}</td>
        <td>{{ device.SoftwareVersion }}</td>
        <td>{{ device.ProtocolVersion }}</td>
        <td>{{ device.ProductId }}</td>
        <td>{{ device.ProductTypeId }}</td>
        <td><small>{{ device.HashCode }}</small></td>
        <td>{{ device.Status }}</td>
        <td>{{ device.LastErrorMsg }}</td>
        <td><small>{{ device.FirstUseDate|replace("T"," ") }}</small></td>
        <td><small>{{ device.LastUpdate|replace("T"," ") }}</small></td>
        <td>{{ device.SecurityLevel }}</td>
        <td><a data-toggle="collapse" href="#properties_{{ device.Id }}">Properties</a></td>

        <td style="min-width: 100px">
            <a href="/ui/inter_console?filter=/dev/{{ device.CommunicationTechnology }}/{{ device.Address }}&mode=normal">Interact</a>
            <p><a target="_blank" href="http://prov01.smartly.no/live/SDC/GetDeviceList?HashCode={{ device.HashCode }}">SDC lookup</a></p>
        </td>
      </tr>
     <tr>
         <td colspan="18" >

        <div id="endpoints_{{ device.Id }}" class="panel-collapse collapse ">
          <h5>List of Endpoints</h5>
          <div class="panel-body">
              <table class="table table-condensed table-bordered">
                  <thead>
                  <tr><th>Id</th>
                      <th>Type</th>
                      <th>Uri</th>
                      <th>Capabilities</th>

                      <th>Property</th>
                  </tr>
                  </thead>
                  <tbody>
                   {% for endp in device.EndPoint %}
                    <tr><td>{{ endp.Id }}</td>
                        <td>{{ endp.Type }}</td>
                        <td><a href="/ui/inter_console?filter={{ endp.Uri }}&mode=normal">{{ endp.Uri }}</a></td>
                        <td>{{ endp.Capabilities }}</td>
                        <td>{{ endp.Property }}</td></tr>
                   {% endfor %}
                  </tbody>

              </table>
          </div>
        </div>
        <div id="properties_{{ device.Id }}" class="panel-collapse collapse ">
          <h5>List of Properties</h5>
          <div class="panel-body">
              <table class="table table-condensed table-bordered">
                  <thead>
                  <tr><th>Id</th>
                      <th>Type</th>
                      <th>Key</th>
                      <th>Value</th>
                      <th>Configurable</th>
                      <th>State</th>
                  </tr>
                  </thead>
                  <tbody>
                   {% for prop in device.Property %}
                    <tr><td>{{ prop.Id }}</td>
                        <td>{{ prop.Type }}</td>
                        <td>{{ prop.Key }}</td>
                        <td>{{ prop.Value }}</td>
                        <td>{{ prop.IsUserConfigurable }}</td>
                        <td>{{ prop.State }}</td>
                   {% endfor %}
                  </tbody>

              </table>
          </div>
        </div>
        <div id="collapseLocation" class="panel-collapse collapse">
          <div class="panel-body">
              Location
          </div>
        </div>
        <div id="properties_{{ device.Id }}" class="panel-collapse collapse">
          <div class="panel-body">
            <h5>List of Properties</h5>
          </div>
        </div>
     </td> </tr>

   {% endfor %}
{% endif %}
  <tbody>
</table>

</div>


{% endblock %}
{% block js_scripts %}
    <script src="/static/js/stupidtable.min.js"></script>


{% endblock %}
